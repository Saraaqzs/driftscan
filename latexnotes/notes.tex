
\documentclass[prd,twocolumn,nofootinbib]{revtex4}


\input{mathdef}

\usepackage{tikz}
\usetikzlibrary{arrows,decorations.pathmorphing,backgrounds,positioning,fit,petri}


\newcommand{\tcite}[1]{#1}

\usepackage{mathpazo}

\begin{document}

\title{Cylinder Notes}

\maketitle



\section{Formalism}

\subsection{Unpolarised Case}

This is based on a combination of the notation of Albert and Ue-Li, I've just
ripped off some of their notation. I'm keeping this unpolarised for the time
being, however this is a really bad approximation for cylinders.

A particular feed $F_i$ measures a combination of the electric field $E(\vnhat)$
coming from various directions on the sky.
\begin{equation}
F_i = \int d^2\vnhat \, A_i(\vnhat) E(\vnhat) e^{2 \pi i \vnhat\cdot\vu_i}\; ,
\end{equation}
where the function $A_i(\vnhat)$ gives the amplitude of the reponse in that
direction, the exponential factor keeps track of the phase relative to an
arbitrary reference point, and $\vu_i$ is the displacement to that point,
divided by the wavelength. We assume that the radiation from the sky is
\emph{incoherent}, that is
\begin{equation}
\la E(\vnhat) E^* (\vnhat') \ra = \delta(\vnhat - \vnhat') I(\vnhat) \; .
\end{equation}

In traditional interferometry a visibility $\tvis_{ij}$ is the correlation
between two feeds $F_i$ and $F_j$ at a particular instant
\begin{align}
  \tvis_{ij} & = \la F_i F_j^* \ra \\
  &= \int d^2\vnhat \, A_i(\vnhat) A_j^*(\vnhat) e^{2 \pi i \vnhat \cdot \vu_{ij}}
  I(\vnhat)
\end{align}
where $\vu_{ij} = \vu_i - \vu_j$, the separation in the UV plane. However, for
our purposes where we are concerned with observing continuous fields it will be
convenient to rescale this definition, and use a quantity
\begin{align}
\label{eq:nvis}
\vis_{ij} & = \frac{\nu^2}{2 k_b c^2 \Omega_{ij}} \tvis_{ij} \\ 
&= \frac{1}{\Omega_{ij}}\int d^2\vnhat \, A_i(\vnhat) A_j^*(\vnhat)
  e^{2 \pi i \vnhat \cdot \vu_{ij}} T(\vnhat)
\end{align}
where we have switched to using the brightness temperature $T$ instead of the
intensity $I = 2 k_b \nu^2 T / c^2$. The quantity $\Omega_{ij} = \sqrt{\Omega_i
  \Omega_j}$ is the geometric mean of the individual beam solid angles
\begin{equation}
\Omega_i = \int \lv A_i(\vnhat) \rv^2 d^2\vnhat
\end{equation}
which is also gives the effective antenna area $A_\text{eff} = \Omega
\lambda^2$. The usefulness of this definition of $\vis_{ij}$ is that our
visibilities are a temperature-like quantity whereas the usual quantity $\tvis$
is a flux --- specifically for a sky with uniform brightness temperature, with
our definition, the auto-correlation of an antenna $\vis_{ii} = T_b$.


The visibilities are sensitive to localised regions of the sky and so as the
Earth rotates their measured values change, we take this into account by
explicitly including the dependence on the azimuthal angle $\phi$, assuming that
we average over all measured sidereal days. The measured visibilities are also
corrupted by instrumental noise, which we must explicitly take account of by
adding a noise term $n_{ij}(\phi)$\footnote{Unlike the sky, the instrumental
  noise is not strictly periodic in $\phi$, however, provided it is stationary
  we can treat it as such when combining the measured sidereal days.}. For
brevity of notation, we will introduce an index $\alpha$ which represents
particular pairs $ij$ of feeds (a specific visibility), and will write
\eqref{eq:nvis} in terms of a transfer function $B_\alpha$. In all this leaves
the measured visibility as
\begin{equation}
  V_\alpha(\phi) = \int \! d^2\vnhat\, B_\alpha(\vnhat; \phi) T(\vnhat) + n_\alpha(\phi)
\end{equation}
where the transfer function is
\begin{equation}
  B_{ij}(\vnhat; \phi) = \frac{1}{\Omega_{ij}}A_i(\vnhat; \phi) A_j^*(\vnhat;
  \phi) e^{2 \pi i \vnhat \cdot\vu_{\alpha}(\phi)} \; .
\end{equation}
As expected in the rotating system the $UV$-plane changes orientation with
respect to the celestial sphere. Given the periodicity of the system, Fourier
transforming the system is an obvious next step
\begin{align}
  V^\alpha_m &= \int \frac{d\phi}{2\pi} V_\alpha(\phi) e^{-i m \phi} \\
  & = \sum_{l m'}\int \frac{d\phi}{2\pi} B^\alpha_{l m'}(\phi) a^{T*}_{l m'}
  e^{-i m \phi}+ n^\alpha_m
\end{align}
where to proceed to the second line we have inserted the spherical harmonic
expansions of both the sky, and the beam transfer function. As the $\phi$
dependence simply rotates the functions about the polar axis the transfer
function is trivially $B^\alpha_{lm}(\phi) = B^{\alpha}_{lm}(\phi=0)$. Combined
with the exponential factor in the integral, this simply generates the
Kroenecker delta $\delta_{mm'}$, and we find
\begin{equation}
\label{eq:vis_unpol}
V^\alpha_m = \sum_{l} B^\alpha_{l m} a^{T*}_{l m}+ n^\alpha_m \; .
\end{equation}
As we can see this transformation does not mix $m$-modes on the sky, and can
therefore be performed on an $m$-by$m$ basis. This will be important later when
we project the correlations on the sky into visibilities.

\subsection{Sensitivity in $(l,m)$ space}

Much of the usefulness \eqref{eq:vis_unpol} is that it reduces the problem down
to a finite number of modes in harmonic space. This is because the finite size
of the optical system means that the beam is insensitive to the largest
multipoles.

Let us consider an example, a dipole pair on two different cylinder (see
Figure~\ref{fig:cylinder}). These correspond to a position in the u-v place of
$u = W / \lambda$ and $v = D / \lambda$ (ignoring the small cylinder separation
$\lambda$ for now). In terms of spherical harmonics coefficients on the sky,
points in the u-v plane map to $m \sim 2\pi u$ and $l \sim \sqrt{m^2 + (2\pi
  v)^2}$. However because of the finite cylinder width (and separation) the
visibilities are sensitive to a range in $m$ which is calculated from the
convolution of the apertures in the u-v plane
\begin{equation}
  V_{m} \ne 0 \quad\text{for}\quad \frac{2 \pi \epsilon}{\lambda} < m < \frac{4 \pi
    W}{\lambda}
\end{equation}
which corresponds to the closest, and furthest points of each cylinder. This
means that when we are considering quantities like the beam transfer
$B_{\alpha,l}^{m,\nu}$ we only need consider a finite range in $m$ as we can't
possibly be sensitive to higher values.

\begin{figure}
\centering
\begin{tikzpicture}[ scale=.8 ]

\draw (0,0) -- (4,0) -- (4,6) -- (0,6) -- cycle;
\draw (4.1,0) -- (8.1,0) -- (8.1,6) -- (4.1,6) -- cycle;

\draw[fill=black] (2,3) circle(0.1);
\draw[fill=black] (6.1,4) circle(0.1);

\draw[<->] (0,-0.5) -- (4,-0.5)
node [below,midway] {$W$};

\draw[dashed] (0,3) -- (10,3);
\draw[dashed] (0,4) -- (10,4);

\draw[<->] (9.5,3) -- (9.5,4)
node [right,midway] {$D$};

\draw[dashed] (2,0) -- (2,8);
\draw[dashed] (6.1,0) -- (6.1,8);

\draw[<->] (2,7) -- (6.1,7)
node [above,midway] {$W+\epsilon$};


\end{tikzpicture}
\caption{A pair of cylinders (infintely long) of width $W$ and separation
  $\epsilon$. We consider a pair of dipoles one on each cylinder, such that they
  are separated by $W+\epsilon$ In the E-W direction and by $D$ in the N-S
  direction.}
\label{fig:cylinder}
\end{figure}




\subsection{Polarised Case}

Extending to the polarised case seems not to be too difficult, it just requires
some careful generalisation of the above case. Again taking many cues from
Albert.

In this case a feed is generalised, with the index referring not just to the
position on the telescope but the polarisation too
\begin{equation}
  F_i(\phi) = \int d^2\vnhat \, A^a_i(\vnhat; \phi) E_a(\vnhat) e^{2 \pi i
    \vnhat\cdot\vu_i(\phi)}\; .
\end{equation}
In this the index summation over $a$ accounts for the relative angles of the
polarisation and feed. In most cases it should be possible to seperate the
function $A_i^a$ into an angular reception pattern $A_i$, and a vector
$\hat{d}_i^a$, representing the alignment of the dipole for the feed
\begin{equation}
  A_i^a(\vnhat; \phi) = A_i(\vnhat; \phi) \hat{d}^a_i \; .
\end{equation}
The radiation from the sky is still \emph{incoherent}, but now we must include
its polarisation (neglecting circular polarisation)
\begin{multline}
\label{eq:EEpol}
  \la E_a(\vnhat) E_b^* (\vnhat') \ra = \frac{2 k_b \nu^2}{c^2} \delta(\vnhat - \vnhat') \\ \times \left[\calP_{ab}^T
    T(\vnhat) + \calP_{ab}^Q Q(\vnhat) + \calP_{ab}^U U(\vnhat)\right] \; .
\end{multline}
As in the unpolarised case we are more interested in the brightness temperature
on the sky, and so we have written \eqref{eq:EEpol} to make that explicit (thus
$Q$, and $U$ are polarisation brightness temperatures). The polarisation tensors
$\calP^X_{ab}$ are related to the Pauli matrices (in an orthonormal basis),
specifically
\begin{gather}
\calP^I_{ab} = \frac{1}{2}\begin{pmatrix} 1 & 0 \\ 0 & 1\end{pmatrix},
\qquad
\calP^Q_{ab} = \frac{1}{2}\begin{pmatrix} 1 & 0 \\ 0 & -1\end{pmatrix},
\\ \intertext{and}
\calP^U_{ab} = \frac{1}{2}\begin{pmatrix} 0 & 1 \\ 1 & 0\end{pmatrix}.
\end{gather}
The standard basis to use in spherical geometry are the polar and azimuthal
directions, $\hat{\theta}$ and $\hat{\phi}$, as these allow spin spherical
harmonics to be used straightforwardly to decompose the polarisation field.

A visibility has the same definition as before, but now we need to take into
account the polarisations of the feeds, and the sky
\begin{multline}
\label{eq:vispol}
V_{ij}(\phi) = \int \, \Bigl[ B^T_{ij}(\vnhat; \phi) T(\vnhat) + B^Q_{ij}(\vnhat; \phi) Q(\vnhat)\\
  + B^U_{ij}(\vnhat; \phi) U(\vnhat) \Bigr] d^2\vnhat + n_{ij}(\phi)
\end{multline}
where the beam transfer functions $B^X_{ij}$ are
\begin{equation}
B^X_{ij}(\vnhat; \phi) = \frac{1}{\Omega_{ij}}A_i^a(\vnhat; \phi) A_j^{b *}(\vnhat; \phi)
\calP^X_{ab} \:e^{2 \pi i \vnhat \cdot
  \vu_{ij}(\phi)} \; .
\end{equation}
To proceed we need to insert the spherical harmonic decompositions, however, as
polarisation is not a scalar field we must expand $Q$ and $U$ in spin-2
harmonics $Y_{lm}^\brsc{\pm 2}(\vnhat)$
\begin{align}
T(\vnhat) & = \sum_{lm} a^T_{lm} Y_{lm}(\vnhat) \; ,\\
Q(\vnhat) + i U(\vnhat) & = \sum_{lm} a^\brsc{+2}_{lm}
Y^\brsc{+2}_{lm}(\vnhat) \; ,\\
Q(\vnhat) - i U(\vnhat) & = \sum_{lm} a^\brsc{-2}_{lm}
Y^\brsc{-2}_{lm}(\vnhat) \; .
\end{align}
In actual fact we will insert the complex conjugate of the above expressions
($T$, $Q$ and $U$ are real). The polarised beam transfer matrices also transform
as spin fields, and so we decompose them in the same way, with
\begin{align}
B^Q_{\alpha}(\vnhat; \phi) + i B^U_{\alpha}(\vnhat; \phi) & = \sum_{lm}
B^\brsc{+2}_{\alpha;lm} (\phi)
Y^\brsc{+2}_{lm}(\vnhat) \; ,\\
B^Q_{\alpha}(\vnhat; \phi) - i B^U_{\alpha}(\vnhat; \phi) & = \sum_{lm}
B^\brsc{-2}_{\alpha;lm} (\phi)
Y^\brsc{-2}_{lm}(\vnhat) \; .
\end{align}
where for brevity we have again switched to using $\alpha$.

Combined with the orthogonality of the (spin) spherical harmonics this
allows us to rewrite the visibility equation \eqref{eq:vispol} as
\begin{multline}
V_{\alpha}(\phi) = \sum_{lm} \Bigl[B_{\alpha;lm}^T(\phi) a^{T*}_{lm} +
\frac{1}{2} B_{\alpha;lm}^\brsc{+2}(\phi) a^{\brsc{+2}*}_{lm} \\+
\frac{1}{2} B_{\alpha;lm}^\brsc{-2}(\phi) a^{\brsc{-2}*}_{lm}\Bigr] + n_{\alpha}(\phi)
\; .
\end{multline}
Though this has thoroughly transformed the problem into harmonic
space, it will be more convenient if we further transform into the
conventional $E$ and $B$ mode decomposition. This can be done by
making the standard substitutions
\begin{align}
a^\brsc{+2}_{lm} & = -\left(a^E_{lm} + i a^B_{lm}\right) \; ,\\
a^\brsc{-2}_{lm} & = -\left(a^E_{lm} - i a^B_{lm}\right)
\end{align}
as well as the corresponding changes for the beam matrices
\begin{align}
  B^\brsc{+2}_{\alpha;lm} & = -\left(B^E_{\alpha;lm} + i B^B_{\alpha;lm}\right) \; ,\\
  B^\brsc{-2}_{\alpha;lm} & = -\left(B^E_{\alpha;lm} - i B^B_{\alpha;lm}\right)
  \; ,
\end{align}
leaving the visibility as
\begin{multline}
V_{\alpha}(\phi) = \sum_{lm} \Bigl[B_{\alpha;lm}^T(\phi) a^{T*}_{lm} \\+
B_{\alpha;lm}^E(\phi) a^{E*}_{lm} + B_{\alpha;lm}^B(\phi)
a^{B*}_{lm}\Bigr] + n_{\alpha}(\phi)
\; .
\end{multline}
In the above the harmonic coefficients are now all the transforms of real scalar
(or pseudo-scalar) fields. All that is left is to perform the Fourier transform
in $\phi$, which proceeds as in the unpolarised case to give
\begin{multline}
V_{\alpha; m} =\\ \sum_{l} \left[B_{\alpha;lm}^T a^{T*}_{lm} +
B_{\alpha;lm}^E a^{E*}_{lm} + B_{\alpha;lm}^B
a^{B*}_{lm}\right] + n_{\alpha; m}
\; .
\end{multline}




\section{Matrix Notation}

The beam transfer matrices above can be written in an explicit matrix notation.
\begin{equation}
\left(\mB_m^X\right)_{(\alpha \nu) (l \nu')} = B_{\alpha;lm}^X \delta_{\nu \nu'}
\end{equation}
where the row index labels all baseline+feed ($\alpha$) and frequency
combinations ($\nu$), whereas the column index is over all multipole ($l$) and
frequencies ($\nu'$). From here onwards we'll drop the subscript $m$, denoting
the spherical harmonic order, all the equations below are valid for any $m$.

The number of distinct baselines $\alpha_n$ is different to the
maximum multipole sampled $l_\tmax$, and usually $l_\tmax \ll \alpha_n$. The matrix
$\mB_X$ is of size $m \times n$, where $m = \alpha_n \nu_n$, $n = l_\tmax \nu_n$
and $\nu_n$ is the number of frequency bins. The sky, which we'll write as a
vector $\va_X$ of length $n$, is projected onto a much higher dimensional space
of visibilities $\vv$ (vector length $m$)
\begin{equation}
\vv = \left(\mB_T \va_T^* + \mB_E \va_E^* + \mB_B \va_B^* \right) + \vn
\end{equation}
where the noise vector $\vn$ is of length $m$. For notational convenience we can
define the block matrix and vector
\begin{equation}
\mB = \left(\begin{array}{c|c|c} & & \\ \mB_T & \mB_E & \mB_B \\ &
    &\end{array}\right)
\;, \quad
\va = \left(\begin{array}{c} \va_T \\ \hline \va_E \\ \hline
    \va_B\end{array}\right)
\end{equation}
of size $m \times 3 n$ and $3 n$, such that
\begin{equation}
\label{eq:matnot}
\vv = \mB\, \va^* + \vn \; .
\end{equation}
The unpolarised calculation can be put in the same form, where $\mB = \mB_T$, an
$m \times n$ matrix; $\va = \va_T$, a length $n$ vector; and the noise $\vn$ and
visibility $\vv$ vectors are of length $m$.



\section{Signal Covariance and Foreground Separation}

By averaging over sidereal days, and performing the $m$-transform the entire
dataset can be represented by a complex vector indexed by the combination of
baseline+feed, frequency channel, and $m$-mode. For CHIME this is a vector of
length $\sim 10^9$.

To extract the 21-cm signal from the data we need to construct the two-point
statistics of our data, the \emph{signal covariance matrix}
\begin{multline}
\label{eq:signal_cv_full}
C_{(\alpha \nu m); (\alpha' \nu' m')} = \la V^m_{\alpha \nu} V^{m *}_{\alpha'
  \nu'} \ra \\
 = \sum_{l l' X Y} B^{X \alpha \nu}_{l m} \la a_{l m \nu}^{X *} a_{l' m' \nu'}^{Y} \ra
B^{Y \alpha' \nu' *}_{l' m'} + \la n_{(\alpha \nu m)} n^*_{(\alpha' \nu' m')} \ra
\end{multline}
which we have projected back onto the statistics of the sky by use of the beam
transfers calculated above. The indices $X$ and $Y$ represent the polarisation
components on the sky $X, Y \in \{T, E, B\}$. This leads to dense matrices of
size $\sim 10^9 \times 10^9$ which are impossible to treat at the present.

Instead, let us make an approximation that will dramatically reduce this, if we
think of the sky as a statistically isotropic random field, its two point
statistics become dramatically simpler
\begin{equation}
\la a_{l m \nu'}^X a_{l' m' \nu'}^{Y *} \ra = C^{XY}_l(\nu, \nu') \delta_{l l'}
\delta_{m m'} \; ,
\end{equation}
and importantly, they are automatically diagonal in the $m$-mode. This means
that the full signal covariance \eqref{eq:signal_cv_full} is block diagonal, and
allows us to calculate all statistics on an $m$-by-$m$ basis. For a specific
$m$-mode
\begin{equation}
C_{(\alpha \nu); (\alpha' \nu')} = \sum_{l X Y} B^{X \alpha \nu}_{l} B^{Y \alpha'
  \nu' *}_{l'} C^{XY}_l(\nu, \nu') + N_{(\alpha \nu); (\alpha' \nu')} \; ,
\end{equation}
where we have dropped all the $m$-indices, and $N$ is the power spectrum on the
isntrumental noise. In matrix notation
\begin{equation}
\mC = \mB \mC_\text{sky} \mB^\hconj + \mN_\text{inst} \; .
\end{equation}

With this we can construct signal and noise covariance matrices. The signal
matrix, $\mS$ contains only the 21-cm signal the we want to extract
\begin{equation}
\mS = \mB \mC_{21} \mB^\hconj
\end{equation}
whereas the noise covariance contains everything else, both the instrumental
noise and the astrophysical foregrounds
\begin{equation}
\mN = \mB \mC_f \mB^\hconj + \mN_\text{inst} \; .
\end{equation}
Using these two matrices we can construct a signal-noise eigenbasis $\vx_i$
which is statistically uncorrelated, $\la \vx_i \vx_j \ra = \delta_{ij}$, where
each eigenvalue describes the ratio of signal-noise power.

Foreground subtraction is by only retaining modes with eigenvalue (signal to
noise power) greater than some threshold, $t$. Let us denote the covariance of
the remaining modes as $\mCt$ (the diagonal matrix of the eigenvalues),
and the matrix with each modes as a row vector as $\mQt$.

\section{Optimal Power Spectrum Estimation}

Following Tegmark 1997.

Let us parameterise the matter power spectrum we are trying to estimate in terms
of a linear summation of different basis functions
\begin{equation}
P(\vk) = \sum_a p_a P_a(\vk) \; .
\end{equation}
For instance, to estimate different bandpowers, the $P_a(\vk)$ could simply be
spherical shells of different radii. As this parameterisation is linear in the
two point function, we can simply calculate the angular power spectra $C_{a;
  l}(\nu, \nu')$ corresponding to each of the basis functions $P_a(\vk)$, and
then project this onto the remaining eigenmodes to give a correlation matrix
\begin{equation}
\mCt_{a} = \mQt \mB \mC_{21,a} \mB^\hconj \mQt^\hconj \; .
\end{equation}

The quadratic estimator for the parameter $p_a$, for one $m$-mode is given by 
\begin{equation}
\hat{p}_a = \vx^\hconj \mE_a \vx - \tr{\mE_a}
\end{equation}
where $\vx$ is the data projected onto the remaining signal modes, and we have
used the fact that the KL-transform has scaled the noise to the identity matrix
to simplify the trace term. The matrix
\begin{equation}
\mE_a = \frac{1}{2} \sum_b F_{ab}^{-1} \mCt^{-1} \mCt_b \mCt^{-1}
\end{equation}
where $F_{ab}$ is the Fisher matrix
\begin{equation}
F_{ab} = \frac{1}{2} \tr{\ls \mCt_a \mCt^{-1} \mCt_b \mCt^{-1} \rs} \; .
\end{equation}
If the input model used for calculating the eigenmodes is correct, the
covariance of the parameters $\la \hat{p}_a \hat{p}_b \ra = C_{ab}$ is simply
equal to the inverse of the Fisher matrix $F_{ab}^{-1}$.

The above was only for a single $m$-mode, however it trivially generalises to
combining all $m$-modes. By thinking about the problem as being block diagonal
in $m$ we can write the estimator as
\begin{multline}
\hat{p}_a = \frac{1}{2} \sum_b \mathcal{F}_{ab}^{-1}\\ \times \sum_m \ls \vx^\hconj \mCt^{-1}
\mCt_b \mCt^{-1} \vx - \tr{\left(\mCt^{-1} \mCt_b \mCt^{-1}\right)} \rs
\end{multline}
where the quantity in square brackets is implicitly $m$-dependent, and the
overall Fisher matrix $\mathcal{F}_{ab}$ is the summation of the matrix for each
$m$
\begin{equation}
\mathcal{F}_{ab} = \sum_m F_{ab}^\brsc{m} \; .
\end{equation}

This can be expressed more simply as the weighted average of the estimators for
each $m$
\begin{equation}
\hat{p}_a = \sum_{b} \mathcal{F}_{ab}^{-1} \sum_c F_{bc}^\brsc{m} \hat{p}_c^\brsc{m} 
\end{equation}
which when the input model is exact is the correctly weighted linear average.


\section{SVD projection}

Fundamentally we are only interested in deriving real properties of the sky,
which is usually of much lower dimension than the space of visibilities, and so
for computational efficiency it make sense to project out degrees of freedom
that cannot describe a polarised sky. For example for a non-commensurately
spaced array, the number of unique visibilities $\alpha_n$ is of order the
number of feeds squared, and thus $\alpha_n \sim 10^6$, whereas we are only
sensitive up to about $l_\tmax \sim 1000$ --- in this case projecting onto the
subspace saves about a factor of $10^6$ in storage and $10^9$ in computation
time.

However as $\mB$ is not guaranteed to be full-rank, we cannot project
\eqref{eq:matnot} with a (pseudo-)inverse matrix. By performing the singular
value decomposition of $\mB$
\begin{equation}
\mB = \mU \msigma \mV^\dagger
\end{equation}
which can be expressed in terms of the decompositions of the individual blocks
$\mB_X = \mU_X \msigma_X \mV^{\dagger}_X$ as
\begin{gather}
\mU =  \left(\begin{array}{c|c|c} & & \\ \mU_T & \mU_E & \mU_B \\ &
    &\end{array}\right) \; , \quad
\msigma =  \left(\begin{array}{c|c|c} \msigma_T & & \\ \hline & \msigma_E & \\
    \hline & & \msigma_B \end{array}\right)
 \; , \\
\mV =  \left(\begin{array}{c|c|c} \mV_T & & \\ \hline & \mV_E & \\
    \hline & & \mV_B\end{array}\right) \; .
\end{gather}
To project down onto the subspace we can simply pre-multiply \eqref{eq:matnot}
with the matrix of left-singular vectors $\mU^\dagger$. Defining $\vvt =
\mU^\dagger \vv$, $\vnt = \mU^\dagger \vn$ and $\mBt = \mU^\dagger \mB = \msigma
\mV^\dagger$, we have
\begin{equation}
\label{eq:matnot2}
\vvt = \mBt\, \va^* + \vnt = \msigma \mV^\dagger \va^* + \mU^\dagger \vn \; .
\end{equation}

A useful simplification comes from the fact that the measured visibilities do
not mix any frequencies. This means that the beam matrices $\mB_X$ are
block-diagonal in frequency and therefore their SVD decomposition is the obvious
block-diagonal combination of the SVDs of individual frequencies.


\section{Ue-Li's Talk}

\newcommand{\vlrarrow}{\ensuremath{\xrightarrow{\qquad\quad}}}

Our desire when mapping \tcm{} intensity is to obtain quantities like the
angular diameter distance $d_A$ and the Hubble parameter $H(z)$ as a function of
redshift. This needs several stages, and importantly means propagating the
errors through all of them
\begin{equation}
  T(\theta, \nu) \xrightarrow[\text{thermal noise }\vn]{B_\alpha(\theta,\nu)} \quad \begin{matrix} \\ \\V_\alpha^\nu \\ \\ \mN\end{matrix} \quad
  \vlrarrow \quad a_{lm}^\nu  \quad \vlrarrow \quad \begin{matrix} \\ \\P(k, \mu; z) \\ \\ \mC_P \end{matrix}  \quad \vlrarrow \quad \begin{matrix} \\ \\  d_A,\: H(z)  \\ \\ \sigma_d, \; \sigma_H \end{matrix} \; .
\end{equation}
The observation takes the sky $T(\theta, \nu)$ and maps it onto a set of
visibilities $V_\alpha^\nu$ through the beam transfer function $B_\alpha(\theta,
\nu)$ with some added thermal noise $\vn$. The index $\alpha$ refers to the set
of all measurements, that is baselines, polarisations etc. Taking into account
the statistics of the noise $\mN$ this must be reduced down to a map of the sky,
from which we can remove any foregrounds and this is then propagated into a
power spectrum $P(k, \mu; z)$ (with a covariance $\mC_P$) from which the
interesting quantites $d_A(z)$, $H(z)$ and their errors can be deduced.

The sky itself can be decomposed into spherical harmonics
\begin{equation}
T(\theta, \nu) = \sum_{lm} Y_{lm}(\theta) a_{lm}^\nu \; .
\end{equation}
If we are using a transit telescope such as CHIME, the observations are periodic
in the rotation of the Earth, provided the telescope has been `rigidised' giving
stationnary noise $\vn$. This allows us to decompose the visibilities
$V_\alpha^{\nu}(\theta)$ (which are a function of right-ascension $\phi$) onto a
periodic basis
\begin{equation}
V_\alpha^m = \int V_\alpha(\phi) e^{i m \phi} d\phi \; .
\end{equation}
This set of visibility modes is the sum the sky, beamed onto the visibility,
plus the instrumental noise added into the mode. Decomposing the beam into
spherical harmonics, this is written as
\begin{equation}
V_\alpha^{m,\nu} = \sum_{l \geq m} B_{\alpha,l}^{\nu,m} a_{lm}^\nu + n_\alpha^m \; .
\end{equation}
We want to extract the sky $a_{lm}$ from this, and we can do this by looking at
the least squares solution
\begin{equation}
\tilde{\va} = {\underbracket{(\mB^\hconj \mN^{-1} \mB)}_{\text{singular}}}^{-1} \mB^\hconj \mN^{-1} \vv \; .
\end{equation}
As we expect the quantity in brackets to be singular this motivates the use of
the dirty map
\begin{equation}
\tilde{\va}^0 = \mB^\hconj \mN^{-1} \vv \; .
\end{equation}
What exactly is the noise matrix $\mN$? If we were simply interested in mapping
the sky it would simply be the covariance of the instrumental noise, however as
we are interested in the \tcm {} signal it is actually the covariance of the
data with this set to zero and so it should include galactic foregrounds
\begin{equation}
N_{\alpha \alpha'} = \la V_\alpha V_{\alpha'} \ra \rvert_{s = 0}  = \delta_{\alpha \alpha'} \sigma_n^2 + F_{\alpha \alpha'}
\end{equation}
where $F_{\alpha\alpha'}$ is the foreground covariance transfered into the
observed qspace. In the above we have omitted the $m$ and $\nu$ indices for
clarity.

For simplicity let's assume that the foregrounds are isotropic (depend only on
$l$), and are perfectly correlated in frequency, then they can be written as
\begin{equation}
\la a^f_l a^f_{l'} \ra = C_l^f \delta_{l l'} \delta_{m m'} F(\nu) F(\nu') \; .
\end{equation}

The beam matrix transfers the foreground correlations on the sky into their
noise contribution
\begin{equation}
N_{\alpha \alpha'} = \delta_{\alpha \alpha'} \sigma_n^2 + \underbracket{B_{\alpha l} C_l^f B_{\alpha' l}^\hconj}_{F_{\alpha \alpha'}} \; .
\end{equation}
To diagonalise the foreground contribution $\mat{F} = \mS \mat{\Lambda}
\mS^\hconj$ we need to rotate the space of visibilities $\vec{w} = \mS^\hconj
\vv$. As the instrumental noise component is the identity matrix (multiplied by
$\sigma_n^2$), it is unchanged by this transformation. This leaves a new noise
covariance in this basis
\begin{equation}
\mN = \mat{I} \sigma_n^2 + \begin{pmatrix} \lambda_\text{max} & & 0 \\ & \ddots & \\ 0 & & \lambda_\text{min}
\end{pmatrix} \; .
\end{equation}
From this covariance matrix we can see that if $\lambda_\text{min} \gg
\sigma_n^2$, all modes are dominated by foregrounds, and the signal can never be
seen with the instrumental precision. As the olny freedom we have is in the beam
$B_\alpha$, the experiment must be designed so that this is not inevitable.

\begin{figure}
\centering
\begin{tikzpicture}[ scale=.8 ]

\draw (0,0) -- (4,0) -- (4,6) -- (0,6) -- cycle;
\draw (4.1,0) -- (8.1,0) -- (8.1,6) -- (4.1,6) -- cycle;

\draw[fill=black] (2,3) circle(0.1);
\draw[fill=black] (6.1,4) circle(0.1);

\draw[<->] (0,-0.5) -- (4,-0.5)
node [below,midway] {$W$};

\draw[dashed] (0,3) -- (10,3);
\draw[dashed] (0,4) -- (10,4);

\draw[<->] (9.5,3) -- (9.5,4)
node [right,midway] {$D$};

\draw[dashed] (2,0) -- (2,8);
\draw[dashed] (6.1,0) -- (6.1,8);

\draw[<->] (2,7) -- (6.1,7)
node [above,midway] {$W+\epsilon$};


\end{tikzpicture}
\caption{A pair of cylinders (infintely long) of width $W$ and separation
  $\epsilon$. We consider a pair of dipoles one on each cylinder, such that they
  are separated by $W+\epsilon$ In the E-W direction and by $D$ in the N-S
  direction.}
\label{fig:2cylinder}
\end{figure}

In Figure~\ref{fig:2cylinder} a dipole pair is considered on two
cylinders. These correspond to a position in the u-v place of $u = W / \lambda$
and $v = D / \lambda$ (ignoring the small cylinder separation $\lambda$ for
now). In terms of spherical harmonics coefficients on the sky, points in the u-v
plane map to $m \sim 2\pi u$ and $l \sim \sqrt{m^2 + (2\pi v)^2}$. However
because of the finite cylinder width (and separation) the visibilities are
sensitive to a range in $m$
\begin{equation}
  V_{m,\nu} \qquad \frac{2 \pi \epsilon}{\lambda} < m < \frac{4 \pi
    W}{\lambda}
\end{equation}
which corresponds to the closest, and furthest points of each cylinder. This
means that when we are considering quantities like the beam transfer
$B_{\alpha,l}^{m,\nu}$ we only need consider a finite range in $m$ as we can't
possibly be sensitive to higher values.

\appendix


\section{Noise Powerspectrum}


\cite{corbella:2004}

Adapting \cite{wrobel:1999} the time integrated power after
correlation has a mean
\begin{equation}
\la \bar{P}_{ij} \ra= \eta_S g_i g_j \frac{\lambda^2}{\sqrt{\Omega_i \Omega_j}}
\Delta\nu S_c
\end{equation}
where $\eta_S$ is the correlation efficiency, $g$ is the gain of each antenna,
$\Omega$ is the beam solid angler for each antenna, $\Delta\nu$ the frequency
channel width and $S_c$ is the correlated flux. The time integrated power has a
variance of
\begin{equation}
\sigma_{\bar{P}}^2 = g_i^2 g_j^2 \Delta\nu^2 \sqrt{\frac{T_{\text{sys},i}
    T_{\text{sys},j}}{2 \tau \Delta\nu}}
\end{equation}

Provided we are in the limit where the system temperature dominates the antenna
temperature, $T_\text{sys} \gg T_A$, the instrumental noise is described by the
radiometer equation
\begin{equation}
\sigma_T^2 = \frac{T_\text{sys}^2(\nu)}{\tau \Delta\nu} \; ,
\end{equation}
where $\tau$ is the integration time, and $\Delta\nu$ is the width of the
bandwidth of the channel. Assuming that the integration is over a uniform
rectangular window of length $\tau$, and the noise has a white spectrum, the
correlation function
\begin{equation}
\zeta(t) = \la n(t') n(t' - t) \ra = \sigma_T^2 \tri{(t / \tau)} \; ,
\end{equation}
where the triangle function $\tri{(x)} = 1 - \left\lvert x \right\rvert$ for
$\left\lvert x \right\rvert < 1$.

As we need to consider the problem in terms of Earth rotation, we identify
distinct sidereal days and treat the averaged noise as periodic. This discrete
power spectrum of the noise, defined by $\la n_m n_m' \ra = N_m \delta_{m m'}$,
is
\begin{equation}
N_m = \frac{T_\text{sys}^2(\nu)}{2 \pi N_\text{day} \Delta\nu_\phi} \sinc{\left(\frac{m
      \Delta\phi}{2}\right)}^2 \; ,
\end{equation}
where $N_\text{day}$ is the number of complete sidereal days that have been
observed, and we have changed units into radians by defining $\Delta\phi = 2\pi
\tau / t_\text{sid}$, and $\Delta\nu_\phi = t_\text{sid} \Delta\nu / 2\pi$.
Usually we would want the integration length to be smaller than any angular
scale we are interested in, in this limit $m \Delta\phi \ll 1$, and the $\sinc$
factor is $\sim 1$.

\section{Signal-Noise Eigenmodes}

% Define a measurement in some vector space
% \begin{equation}
% x^i = s^i + n^i
% \end{equation}
% where $s^i$ and $n^i$ are respectively the signal we are interested in and some
% form of noise. These components have covariance matrices
% \begin{equation}
% \la s^i s^j \ra = S^{ij}, \qquad \la n^i n^j \ra = N^{ij} \; .
% \end{equation}
% Let us start with the generalised eigenvalue equation
% \begin{equation}
% S^{ij} e_j^\alpha = \lambda N^{ij} e_j^\alpha
% \end{equation}
% As $N$ is symmetric positive definite, lets insert its diagonalisation
% $N^{ij} = f^i_a N^{ab} f^j_b$ into the above equation.


\noindent
Define a measurement in a vector space (which may be complex)
\begin{equation}
\vx = \vs + \vn
\end{equation}
where $\vs$ and $\vn$ are respectively the signal we are interested in and some
generalised form of noise (for instance in the case of \tcm this may include
foregrounds). These components have covariance matrices
\begin{equation}
\la \vs \vs^\hconj\ \ra = \mS, \qquad \la \vn \vn^\hconj \ra = \mN \; .
\end{equation}
We are free to transform the measurement vector as we wish $\vx' = \mR\vx$,
provided we are careful to update any related quantities. In the case of
gaussian distributed measurements it is sufficient to transform the covariance
matrix $\mat{X}' = \la (\mR \vx) (\mR \vx)^\hconj \ra = \mR
\mat{X}\mR^\hconj$. The Karhunen-Loeve (KL) transform takes advantage of this to
produce simultaneous eigenmodes of the signal and noise covariances.

Start by making the eigendecomposition of the noise matrix
\begin{equation}
\mN = \mR_1^\hconj \mN' \mR_1
\end{equation}
where $\mR_1$ is the unitary matrix of eigenvectors (stacked row by row), and
$\mN'$ is the diagonal matrix of eigenvalues. Using this we can transform the
data vector $\vx' = \mR_1 \vx$, which produces a new signal covariance
\begin{equation}
\mS' = \la \vs' \vs'^\hconj \ra = \la (\mR_1 \vs)  (\mR_1 \vs)^\hconj
\ra = \mR_1 \mS \mR_1^\hconj
\end{equation}
and reduces the noise matrix to $\mN'$. As the new noise matrix consists solely
of positive diagonal elements $(\mN')_{ii} = \lambda^N_i$, a further
transformation $\vx'' = \mR_2 \vx'$, where $\mR_2 = \mN'^{-\frac{1}{2}}$,
reduces the noise matrix to the identity $\mN'' = \mat{I}$. The signal matrix is
transformed to
\begin{equation}
\mS'' = \mR_2 \mR_1 \mS \mR_1^\hconj \mR_2^\hconj \; .
\end{equation}
Applying any unitary transformation to the data will leave the noise covariance
as the identity. We use this freedom to diagonalise the signal covariance by
eigendecomposition $\mS'' = \mR_3^\hconj \mC \mR_3$, leaving the total
transformation on the data as
\begin{equation}
\vx \rightarrow \vx' = \mR_3 \mR_2 \mR_1 \vx \; .
\end{equation}

Rather than explicitly constructing the three transformations, it is equivalent
to find the solutions to the generalised eigenvalue problem
\begin{equation}
\mS \vx = \lambda \mN \vx \; .
\end{equation}

%% Tidy up explanation.

\bibliographystyle{plain}
\bibliography{cyl}


\end{document}



